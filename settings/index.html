<!DOCTYPE html>
<html>
<head>
    <!-- The '/homey.js' script must be included in your settings view to work -->
    <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
</head>
<body>
<fieldset>
    <legend>Settings</legend>
    <h2 data-i18n="settings.title">
        <!-- This will be filled with the translated string with key 'settings.title'. -->
    </h2>
    <div class="field row">
        <label for="bot-token">Bot Token</label>
        <input id="bot-token" type="text" value=""/>
    </div>
</fieldset>

<fieldset>
    <legend>Users / Group Chats</legend>
    <div class="field row">
        <p id="users">Empty :(</p>
    </div>
</fieldset>

<button id="save" class="right">Save changes</button>
<button id="clear" class="left">Clear users</button>

<script type="text/javascript">
  function onHomeyReady(Homey) {
    let botTokenElement = document.getElementById('bot-token');
    let usersElement = document.getElementById('users');
    let saveElement = document.getElementById('save');
    let clearElement = document.getElementById('clear');

    Homey.get('bot-token', function(err, botToken) {
      if (err) return Homey.alert(err);
      botTokenElement.value = botToken;
    });

    Homey.get('users', function(err, users) {
      if (err) return Homey.alert(err);
      if (users === null) return;
      let json = JSON.parse(users);
      let html = "";
      for(let i = 0; i < json.length; i++) {
        let obj = json[i];

        html += '<p style="text-align:left;">' +
          obj.chatName
          + '<span style="float:right;"> ID: '
          + obj.userId
          + "</span></p>";
      }
      usersElement.innerHTML = html;
    });

    saveElement.addEventListener('click', function(e) {
      Homey.set('bot-token', botTokenElement.value, function(err) {
        if (err) return Homey.alert(err);
      });
    });

    clearElement.addEventListener('click', function(e) {
      Homey.unset('users');
      usersElement.innerHTML = "Empty! :(";
    });
    Homey.ready();
  }
</script>
</body>
</html>
